{
  "data": {
    "type": "metadatadisplay_entity--metadatadisplay_entity",
    "id": "d37a75ec-5da9-4374-b190-71385e630ded",
    "attributes": {
      "name": "IIIF Presentation API 3 Creative Works Series Child Canvases",
      "twig": "{# \nUpdated 22\/11\/2021 for RC3\n\nThis Template generates IIIF 3.0 Canvas only Partial API Manifest from a Strawberry Field\nJSON to be used by a Drupal Views (REST) to generate a simpler to parse\/join listing of Canvases\nFor a Creative Works Series Manifest\n\nNOTE: if you modify this make sure you also open\/save the parent \"IIIF Presentation API 3 Creative Works Series Manifest\" \nMetadatadisplay. Why? because Templates are cached\/render arrays too, so the other one will not know this happened.\n\nStructures passed from Archipelago are\n- node\n  The full Node entity\n- data\n  The Full JSON Structure converted in an Array\n- iiif_server\n  The publicly available IIIF Server (Global Setting)\n\nSince JSON was decoded into the 'data' values are valid PHP but could not\nbe valid JSON when outputting. So We use data.description|json_encode|raw\nWithout Double quotes.\n#}\n{% spaceless %}\n{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/InC-EDU\/1.0\/\" %}\n{% if data.rights|length > 0 or data.rights_statements|length > 0 %}\n\t{% if data.rights|length > 0 %} \n\t\t{% set computed_rights = data.rights %}\n\t{% endif %}\n{% elseif data.rights_statements|length > 0 %}\n\t{% if data.rights_statements in ['In Copyright'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/InC\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['In Copyright - EU Orphan Work'] %} \n    \t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/InC-OW-EU\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['In Copyright - Educational Use Permitted'] %} \n\t   \t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/InC-EDU\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['In Copyright - Non-Commercial Use Permitted'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/InC-NC\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['In Copyright - Rights-holder(s) Unlocatable or Unidentifiable'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/InC-RUU\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['No Copyright - Contractual Restrictions'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/NoC-CR\/1.0\/\" %}\n\t{% endif %} \n\t{% if data.rights_statements in ['No Copyright - Non-Commercial Use Only'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/NoC-NC\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['No Copyright - Other Known Legal Restrictions'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/NoC-OKLR\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['No Copyright - United States'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/NoC-US\/1.0\/\" %}\n\t{% endif %} \n\t{% if data.rights_statements in ['Copyright Not Evaluated'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/CNE\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['Copyright Undetermined'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/UND\/1.0\/\" %}\n\t{% endif %}\n\t{% if data.rights_statements in ['No Known Copyright'] %} \n\t\t{% set computed_rights = \"http:\/\/rightsstatements.org\/vocab\/NKC\/1.0\/\" %}\n\t{% endif %}\n{% endif %}\n{# Mirador 3 has this weird CSS thing that puts the max of thumb to that size #}\n{% set max_thumb_width = 240 %}\n{% set Webserverurl =  url('<front>')|render|replace({':8001\/':''}) ~ ':8183\/iiif\/2\/' %}\n  {% set IIIFserverurl = iiif_server ? iiif_server ~ '\/': Webserverurl %}\n    {% set currenturl = url('<current>')|render %}\n      {% if node.id %}\n          {% set nodeurl = url('entity.node.canonical', {'node': node.id}, {'absolute': true}) %}\n      {% else %}\n          {% set nodeurl = currenturl %}\n      {% endif%}\n            {% set len = language.getId() ? language.getId() : \"en\" %}\n{% endspaceless %}\n{% set metadata %}\n\"metadata\": [\n{% for agent in attribute(data, 'edm_agent') %}\n    {\n      \"label\": {\n        \"{{ len }}\": [\n          {{ agent.role_label|json_encode|raw }}\n        ]\n      },\n      \"value\": {\n        \"{{ len }}\": [\n          {{ agent.name_label|json_encode|raw }}\n        ]\n      }\n    },\n{% endfor %}\n{\n\"label\": {\n\"{{ len }}\": [\n\"description\"\n]\n},\n\"value\": {\n\"{{ len }}\": [\n{{ data.description|json_encode|raw }}\n]\n}\n},\n{\n\"label\": {\n\"{{ len }}\": [\n\"navDate\"\n]\n},\n\"value\":  {\n\"{{ len }}\": [\n\"{{ node.getChangedTime|date(\"F jS \\\\a\\\\t g:ia\") }}\"\n]\n}\n},\n{\n\"label\": {\n\"{{ len }}\": [\n\"license\"\n]\n},\n\"value\": {\n\"{{ len }}\": [\n{{ computed_rights|json_encode|raw }}\n]\n}\n}\n],\n{% endset %}\n{\n\"items\": [\n{% for page in attribute(data, 'as:image') %}\n  {% set cantaloupeid  = IIIFserverurl ~ page['url']|replace({'s3:\/\/':''})|replace({'private:\/\/':''})|url_encode %}\n  {% if page[\"flv:exif\"] %}\n    {% set width = page[\"flv:exif\"].ImageWidth %}\n  {% else  %}\n    {% set width = 1200 %}\n  {% endif %}\n  {% if page[\"flv:exif\"] %}\n    {% set height = page[\"flv:exif\"].ImageHeight %}\n  {% else  %}\n    {% set height = 1600 %}\n  {% endif %}\n  {% set thumb_width = width < max_thumb_width ? with: max_thumb_width %}\n  {% set thumb_height = (thumb_width\/width * height)|round() %}\n  {% set thumbnail %}\n\"thumbnail\": [{\n  \"id\": \"{{ cantaloupeid }}\/full\/{{thumb_width}},\/0\/default.jpg\",\n  \"type\": \"Image\",\n  \"format\": \"image\/jpeg\",\n  \"width\": {{ thumb_width }},\n  \"height\": {{ thumb_height }}\n}],\n  {% endset %}\n\n    {\n      \"id\": \"{{ nodeurl }}\/iiif\/canvas\/p{{ loop.index }}\",\n      \"type\": \"Canvas\",\n      \"label\": { \"none\": [ {{ (data.label ~ ' sequence ' ~ loop.index)|json_encode|raw }}] },\n      {{ metadata }}\n      {{ thumbnail }}\n      \"height\": {{ width }},\n      \"width\": {{ height }},\n      \"items\": [\n        {\n          \"id\": \"{{ nodeurl }}\/iiif\/sequence\/p{{ loop.index }}\/1\",\n          \"type\": \"AnnotationPage\",\n          \"items\": [\n            {\n              \"id\": \"{{ nodeurl }}\/iiif\/annotation\/p{{ loop.index }}\",\n              \"type\": \"Annotation\",\n              \"motivation\": \"painting\",\n              {{ thumbnail }}\n              \"body\": {\n                \"id\": \"{{ cantaloupeid }}\/full\/full,\/0\/default.jpg\",\n                \"type\": \"Image\",\n                \"format\": \"image\/jpeg\",\n                \"service\": [\n                  {\n                    \"id\": \"{{ cantaloupeid }}\",\n                    \"type\": \"ImageService2\",\n                    \"profile\": \"level2\"\n                  }\n                ],\n                \"height\": {{ width }},\n                \"width\": {{ height }}\n              },\n              \"target\": \"{{ nodeurl }}\/iiif\/canvas\/p{{ loop.index }}\"\n            }\n          ]\n        }\n      ]\n    }{{ not loop.last ? ',' : '' }}\n{% endfor %}\n]\n}",
      "langcode": "und",
      "mimetype": "application/json"
    }
  }
}
